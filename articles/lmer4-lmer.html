<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>lme4::lmer Models • equatiomatic</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="lme4::lmer Models">
<meta property="og:description" content="equatiomatic">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">equatiomatic</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro-equatiomatic.html">Introduction to {equatiomatic}</a>
    </li>
    <li>
      <a href="../articles/lmer4-lmer.html">lme4::lmer Models</a>
    </li>
    <li>
      <a href="../articles/tests_and_coverage.html">Tests and Coverage</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/datalorax/equatiomatic/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="lmer4-lmer_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>lme4::lmer Models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/datalorax/equatiomatic/blob/master/vignettes/lmer4-lmer.Rmd"><code>vignettes/lmer4-lmer.Rmd</code></a></small>
      <div class="hidden name"><code>lmer4-lmer.Rmd</code></div>

    </div>

    
    
<p>This vignette is intended to show the wide variety of <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lme4::lmer</a></code> models that can be handled by {equatiomatic}. The output uses the notation from <a href="http://www.stat.columbia.edu/~gelman/arm/">Gelman and Hill</a>. If you notice any errors in the notation, please <a href="https://github.com/datalorax/equatiomatic/issues">file an issue</a>. Similarly, if you try to use {equatiomatic} with an lmer model and end up with an error (either in notation or code) I would <em>really</em> appreciate if you could file an issue with a reproducible example.</p>
<p>This vignette displays many of the models that are covered by the package tests. It also illustrates many of the features of {equatiomatic}, including</p>
<ul>
<li>Automatic detection of group-level predictor variables (and the level at which they predict)</li>
<li>Handling of interactions, both within a level and across levels</li>
<li>Handling of any number of higher-level (or cross-classified) grouping factors (i.e., number of levels or random effects is infinite)</li>
<li>Some support for variance-covariance structure outside of standard unstructured specifications</li>
</ul>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">equatiomatic</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lme4</span>)
<span class="co">#&gt; Loading required package: Matrix</span></pre></body></html></div>
</div>
<div id="unconditional-models" class="section level2">
<h2 class="hasAnchor">
<a href="#unconditional-models" class="anchor"></a>Unconditional models</h2>
<p>A basic two-level unconditional model:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">um_hsb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">math</span> ~ <span class="fl">1</span> + (<span class="fl">1</span><span class="kw">|</span><span class="no">sch.id</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">hsb</span>)
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">um_hsb</span>)
<span class="co">#&gt; Registered S3 method overwritten by 'broom.mixed':</span>
<span class="co">#&gt;   method      from </span>
<span class="co">#&gt;   tidy.gamlss broom</span></pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{math}_{i}  &amp;\sim N \left(\alpha_{j[i]}, \sigma^2 \right) \\
    \alpha_{j}  &amp;\sim N \left(\mu_{\alpha_{j}}, \sigma^2_{\alpha_{j}} \right)
    \text{, for sch.id j = 1,} \dots \text{,J}
\end{aligned}
\]</span></p>
<p>And a model with multiple levels:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">um_long3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">score</span> ~ <span class="fl">1</span> + (<span class="fl">1</span><span class="kw">|</span><span class="no">sid</span>) + (<span class="fl">1</span><span class="kw">|</span><span class="no">school</span>) + (<span class="fl">1</span><span class="kw">|</span><span class="no">district</span>),
                <span class="kw">data</span> <span class="kw">=</span> <span class="no">sim_longitudinal</span>)
<span class="co">#&gt; boundary (singular) fit: see ?isSingular</span>
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">um_long3</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{score}_{i}  &amp;\sim N \left(\alpha_{j[i],k[i],l[i]}, \sigma^2 \right) \\
    \alpha_{j}  &amp;\sim N \left(\mu_{\alpha_{j}}, \sigma^2_{\alpha_{j}} \right)
    \text{, for sid j = 1,} \dots \text{,J} \\
    \alpha_{k}  &amp;\sim N \left(\mu_{\alpha_{k}}, \sigma^2_{\alpha_{k}} \right)
    \text{, for school k = 1,} \dots \text{,K} \\
    \alpha_{l}  &amp;\sim N \left(\mu_{\alpha_{l}}, \sigma^2_{\alpha_{l}} \right)
    \text{, for district l = 1,} \dots \text{,L}
\end{aligned}
\]</span></p>
</div>
<div id="models-with-predictors-at-level-1" class="section level2">
<h2 class="hasAnchor">
<a href="#models-with-predictors-at-level-1" class="anchor"></a>Models with predictors at level 1</h2>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">lev1_hsb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">math</span> ~ <span class="no">female</span> + <span class="no">ses</span> + <span class="no">minority</span> + (<span class="fl">1</span><span class="kw">|</span><span class="no">sch.id</span>), <span class="no">hsb</span>)
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">lev1_hsb</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{math}_{i}  &amp;\sim N \left(\mu, \sigma^2 \right) \\
    \mu &amp;=\alpha_{j[i]} + \beta_{1}(\operatorname{female}) + \beta_{2}(\operatorname{ses}) + \beta_{3}(\operatorname{minority}) \\
    \alpha_{j}  &amp;\sim N \left(\mu_{\alpha_{j}}, \sigma^2_{\alpha_{j}} \right)
    \text{, for sch.id j = 1,} \dots \text{,J}
\end{aligned}
\]</span></p>
<p>Note that in the above, the mean structure at level 1 is broken out into a separate line. You can override this with the <code>mean_separate</code> argument.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">lev1_hsb</span>, <span class="kw">mean_separate</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{math}_{i}  &amp;\sim N \left(\alpha_{j[i]} + \beta_{1}(\operatorname{female}) + \beta_{2}(\operatorname{ses}) + \beta_{3}(\operatorname{minority}), \sigma^2 \right) \\
    \alpha_{j}  &amp;\sim N \left(\mu_{\alpha_{j}}, \sigma^2_{\alpha_{j}} \right)
    \text{, for sch.id j = 1,} \dots \text{,J}
\end{aligned}
\]</span></p>
<p>Similarly, just like with standard <code>lm</code> models, you can specify wrapping, and how many terms per line</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">lev1_hsb</span>, <span class="kw">wrap</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">terms_per_line</span> <span class="kw">=</span> <span class="fl">2</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{math}_{i}  &amp;\sim N \left(\mu, \sigma^2 \right) \\
    \mu &amp;=\alpha_{j[i]} + \beta_{1}(\operatorname{female})\ + \\
&amp;\quad \beta_{2}(\operatorname{ses}) + \beta_{3}(\operatorname{minority}) \\
    \alpha_{j}  &amp;\sim N \left(\mu_{\alpha_{j}}, \sigma^2_{\alpha_{j}} \right)
    \text{, for sch.id j = 1,} \dots \text{,J}
\end{aligned}
\]</span></p>
<p>And one more example with multiple levels</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">lev1_long</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">score</span> ~ <span class="no">wave</span> + (<span class="fl">1</span><span class="kw">|</span><span class="no">sid</span>) + (<span class="fl">1</span><span class="kw">|</span><span class="no">school</span>) + (<span class="fl">1</span><span class="kw">|</span><span class="no">district</span>),
                  <span class="kw">data</span> <span class="kw">=</span> <span class="no">sim_longitudinal</span>)
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">lev1_long</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{score}_{i}  &amp;\sim N \left(\alpha_{j[i],k[i],l[i]} + \beta_{1}(\operatorname{wave}), \sigma^2 \right) \\
    \alpha_{j}  &amp;\sim N \left(\mu_{\alpha_{j}}, \sigma^2_{\alpha_{j}} \right)
    \text{, for sid j = 1,} \dots \text{,J} \\
    \alpha_{k}  &amp;\sim N \left(\mu_{\alpha_{k}}, \sigma^2_{\alpha_{k}} \right)
    \text{, for school k = 1,} \dots \text{,K} \\
    \alpha_{l}  &amp;\sim N \left(\mu_{\alpha_{l}}, \sigma^2_{\alpha_{l}} \right)
    \text{, for district l = 1,} \dots \text{,L}
\end{aligned}
\]</span></p>
</div>
<div id="models-with-unstructured-variance-covariance-specifications" class="section level2">
<h2 class="hasAnchor">
<a href="#models-with-unstructured-variance-covariance-specifications" class="anchor"></a>Models with unstructured variance-covariance specifications</h2>
<p>This should generally work regardless of the complexity.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">hsb1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">math</span> ~ <span class="no">female</span> + <span class="no">ses</span> + <span class="no">minority</span> + (<span class="no">minority</span><span class="kw">|</span><span class="no">sch.id</span>),
               <span class="no">hsb</span>)
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">hsb1</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{math}_{i}  &amp;\sim N \left(\mu, \sigma^2 \right) \\
    \mu &amp;=\alpha_{j[i]} + \beta_{1}(\operatorname{female}) + \beta_{2}(\operatorname{ses}) + \beta_{3j[i]}(\operatorname{minority}) \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{j} \\
      &amp;\beta_{3j}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\mu_{\alpha_{j}} \\
      &amp;\mu_{\beta_{3j}}
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cc}
     \sigma^2_{\alpha_{j}} &amp; \rho\alpha_{j}\beta_{3j} \\ 
     \rho\beta_{3j}\alpha_{j} &amp; \sigma^2_{\beta_{3j}}
  \end{array}
\right)
 \right)
    \text{, for sch.id j = 1,} \dots \text{,J}
\end{aligned}
\]</span></p>
<p>Notice that it correctly parses which variable is randomly varying here. We can also make it more complicated.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">hsb2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">math</span> ~ <span class="no">female</span> + <span class="no">ses</span> + <span class="no">minority</span> + (<span class="no">female</span> + <span class="no">ses</span><span class="kw">|</span><span class="no">sch.id</span>),
               <span class="no">hsb</span>)
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">hsb2</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{math}_{i}  &amp;\sim N \left(\mu, \sigma^2 \right) \\
    \mu &amp;=\alpha_{j[i]} + \beta_{1j[i]}(\operatorname{female}) + \beta_{2j[i]}(\operatorname{ses}) + \beta_{3}(\operatorname{minority}) \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{j} \\
      &amp;\beta_{1j} \\
      &amp;\beta_{2j}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\mu_{\alpha_{j}} \\
      &amp;\mu_{\beta_{1j}} \\
      &amp;\mu_{\beta_{2j}}
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{ccc}
     \sigma^2_{\alpha_{j}} &amp; \rho\alpha_{j}\beta_{1j} &amp; \rho\alpha_{j}\beta_{2j} \\ 
     \rho\beta_{1j}\alpha_{j} &amp; \sigma^2_{\beta_{1j}} &amp; \rho\beta_{1j}\beta_{2j} \\ 
     \rho\beta_{2j}\alpha_{j} &amp; \rho\beta_{2j}\beta_{1j} &amp; \sigma^2_{\beta_{2j}}
  \end{array}
\right)
 \right)
    \text{, for sch.id j = 1,} \dots \text{,J}
\end{aligned}
\]</span></p>
<p>And even really complicated. Note the model below gives a warning.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">hsb3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">math</span> ~ <span class="no">female</span> * <span class="no">ses</span> + <span class="no">minority</span> +
                 (<span class="no">ses</span> * <span class="no">female</span> + <span class="no">minority</span><span class="kw">|</span><span class="no">sch.id</span>),
             <span class="no">hsb</span>)
<span class="co">#&gt; Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :</span>
<span class="co">#&gt; Model failed to converge with max|grad| = 0.00356332 (tol = 0.002, component 1)</span>
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">hsb3</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{math}_{i}  &amp;\sim N \left(\mu, \sigma^2 \right) \\
    \mu &amp;=\alpha_{j[i]} + \beta_{1j[i]}(\operatorname{female}) + \beta_{2j[i]}(\operatorname{ses}) + \beta_{3j[i]}(\operatorname{minority}) + \beta_{4j[i]}(\operatorname{female} \times \operatorname{ses}) \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{j} \\
      &amp;\beta_{1j} \\
      &amp;\beta_{2j} \\
      &amp;\beta_{3j} \\
      &amp;\beta_{4j}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\mu_{\alpha_{j}} \\
      &amp;\mu_{\beta_{1j}} \\
      &amp;\mu_{\beta_{2j}} \\
      &amp;\mu_{\beta_{3j}} \\
      &amp;\mu_{\beta_{4j}}
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{ccccc}
     \sigma^2_{\alpha_{j}} &amp; \rho\alpha_{j}\beta_{1j} &amp; \rho\alpha_{j}\beta_{2j} &amp; \rho\alpha_{j}\beta_{3j} &amp; \rho\alpha_{j}\beta_{4j} \\ 
     \rho\beta_{1j}\alpha_{j} &amp; \sigma^2_{\beta_{1j}} &amp; \rho\beta_{1j}\beta_{2j} &amp; \rho\beta_{1j}\beta_{3j} &amp; \rho\beta_{1j}\beta_{4j} \\ 
     \rho\beta_{2j}\alpha_{j} &amp; \rho\beta_{2j}\beta_{1j} &amp; \sigma^2_{\beta_{2j}} &amp; \rho\beta_{2j}\beta_{3j} &amp; \rho\beta_{2j}\beta_{4j} \\ 
     \rho\beta_{3j}\alpha_{j} &amp; \rho\beta_{3j}\beta_{1j} &amp; \rho\beta_{3j}\beta_{2j} &amp; \sigma^2_{\beta_{3j}} &amp; \rho\beta_{3j}\beta_{4j} \\ 
     \rho\beta_{4j}\alpha_{j} &amp; \rho\beta_{4j}\beta_{1j} &amp; \rho\beta_{4j}\beta_{2j} &amp; \rho\beta_{4j}\beta_{3j} &amp; \sigma^2_{\beta_{4j}}
  \end{array}
\right)
 \right)
    \text{, for sch.id j = 1,} \dots \text{,J}
\end{aligned}
\]</span></p>
</div>
<div id="group-level-predictors" class="section level1">
<h1 class="hasAnchor">
<a href="#group-level-predictors" class="anchor"></a>Group level predictors</h1>
<p>In the <code>sim_longitudinal</code> data that comes with the package, the only level 1 predictor is <code>wave</code>. The <code>group</code> and <code>treatement</code> variables are at the student level (level 2) and <code>prop_low</code> is at the school level. Let’s also add a district level variable (just the average score for each district).</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co"># calculate district means</span>
<span class="no">dist_mean</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(<span class="no">sim_longitudinal</span>$<span class="no">score</span>,
                      <span class="no">sim_longitudinal</span>$<span class="no">district</span>,
                      <span class="no">mean</span>)

<span class="co"># put them in a df to merge</span>
<span class="no">dist_mean</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">district</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">dist_mean</span>),
                        <span class="kw">dist_mean</span> <span class="kw">=</span> <span class="no">dist_mean</span>)

<span class="co"># create a new df with dist_mean added</span>
<span class="no">d</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span>(<span class="no">sim_longitudinal</span>, <span class="no">dist_mean</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"district"</span>)</pre></body></html></div>
<p>Now we can fit a model that should have predictors at every level. We’ll allow <code>wave</code> to vary randomly at each level too.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">group_preds_m1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">score</span> ~ <span class="no">wave</span> + <span class="no">group</span> + <span class="no">treatment</span>  + <span class="no">prop_low</span> + <span class="no">dist_mean</span> +
                         (<span class="no">wave</span><span class="kw">|</span><span class="no">sid</span>) + (<span class="no">wave</span><span class="kw">|</span><span class="no">school</span>) + (<span class="no">wave</span><span class="kw">|</span><span class="no">district</span>),
                       <span class="kw">data</span> <span class="kw">=</span> <span class="no">d</span>)
<span class="co">#&gt; boundary (singular) fit: see ?isSingular</span>
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">group_preds_m1</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{score}_{i}  &amp;\sim N \left(\alpha_{j[i],k[i],l[i]} + \beta_{1j[i],k[i],l[i]}(\operatorname{wave}), \sigma^2 \right) \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{j} \\
      &amp;\beta_{1j}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\gamma_{0}^{\alpha} + \gamma_{1}^{\alpha}(\operatorname{group}_{\operatorname{low}}) + \gamma_{2}^{\alpha}(\operatorname{group}_{\operatorname{medium}}) + \gamma_{3}^{\alpha}(\operatorname{treatment}_{\operatorname{1}}) \\
      &amp;\mu_{\beta_{1j}}
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cc}
     \sigma^2_{\alpha_{j}} &amp; \rho\alpha_{j}\beta_{1j} \\ 
     \rho\beta_{1j}\alpha_{j} &amp; \sigma^2_{\beta_{1j}}
  \end{array}
\right)
 \right)
    \text{, for sid j = 1,} \dots \text{,J} \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{k} \\
      &amp;\beta_{1k}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\gamma_{0}^{\alpha} + \gamma_{1}^{\alpha}(\operatorname{prop\_low}) \\
      &amp;\mu_{\beta_{1k}}
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cc}
     \sigma^2_{\alpha_{k}} &amp; \rho\alpha_{k}\beta_{1k} \\ 
     \rho\beta_{1k}\alpha_{k} &amp; \sigma^2_{\beta_{1k}}
  \end{array}
\right)
 \right)
    \text{, for school k = 1,} \dots \text{,K} \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{l} \\
      &amp;\beta_{1l}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\gamma_{0}^{\alpha} + \gamma_{1}^{\alpha}(\operatorname{dist\_mean}) \\
      &amp;\mu_{\beta_{1l}}
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cc}
     \sigma^2_{\alpha_{l}} &amp; \rho\alpha_{l}\beta_{1l} \\ 
     \rho\beta_{1l}\alpha_{l} &amp; \sigma^2_{\beta_{1l}}
  \end{array}
\right)
 \right)
    \text{, for district l = 1,} \dots \text{,L}
\end{aligned}
\]</span></p>
<div id="interactions" class="section level2">
<h2 class="hasAnchor">
<a href="#interactions" class="anchor"></a>Interactions</h2>
<p>Interactions with multilevel models can be tricky because they can be within or across levels, and the notation changes depending on whether the random effect for the lower level (in the interaction term) is specified as varying randomly within the given level. Luckily, {equatiomatic} handles all of this for you.</p>
<p>First, let’s look at a model with interactions only at level 1.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">l1_hsb_int</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">math</span> ~ <span class="no">minority</span>*<span class="no">female</span> + (<span class="fl">1</span><span class="kw">|</span><span class="no">sch.id</span>),
                     <span class="kw">data</span> <span class="kw">=</span> <span class="no">hsb</span>)
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">l1_hsb_int</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{math}_{i}  &amp;\sim N \left(\mu, \sigma^2 \right) \\
    \mu &amp;=\alpha_{j[i]} + \beta_{1}(\operatorname{minority}) + \beta_{2}(\operatorname{female}) + \beta_{3}(\operatorname{female} \times \operatorname{minority}) \\
    \alpha_{j}  &amp;\sim N \left(\mu_{\alpha_{j}}, \sigma^2_{\alpha_{j}} \right)
    \text{, for sch.id j = 1,} \dots \text{,J}
\end{aligned}
\]</span></p>
<p>And now an interaction at only level 2</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">l2_hsb_int</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">math</span> ~ <span class="no">meanses</span>*<span class="no">sector</span> + (<span class="fl">1</span><span class="kw">|</span><span class="no">sch.id</span>),
                     <span class="kw">data</span> <span class="kw">=</span> <span class="no">hsb</span>)
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">l2_hsb_int</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{math}_{i}  &amp;\sim N \left(\alpha_{j[i]}, \sigma^2 \right) \\
    \alpha_{j}  &amp;\sim N \left(\gamma_{0}^{\alpha} + \gamma_{1}^{\alpha}(\operatorname{meanses}) + \gamma_{2}^{\alpha}(\operatorname{sector}) + \gamma_{3}^{\alpha}(\operatorname{meanses} \times \operatorname{sector}), \sigma^2_{\alpha_{j}} \right)
    \text{, for sch.id j = 1,} \dots \text{,J}
\end{aligned}
\]</span></p>
<p>But more complicated are cross level interactions. Here’s a quick example.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">cl_long1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">score</span> ~ <span class="no">wave</span>*<span class="no">treatment</span> + (<span class="no">wave</span><span class="kw">|</span><span class="no">sid</span>) + (<span class="fl">1</span><span class="kw">|</span><span class="no">school</span>) +
                        (<span class="fl">1</span><span class="kw">|</span><span class="no">district</span>),
                 <span class="kw">data</span> <span class="kw">=</span> <span class="no">sim_longitudinal</span>)
<span class="co">#&gt; boundary (singular) fit: see ?isSingular</span>
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">cl_long1</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{score}_{i}  &amp;\sim N \left(\alpha_{j[i],k[i],l[i]} + \beta_{1j[i]}(\operatorname{wave}), \sigma^2 \right) \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{j} \\
      &amp;\beta_{1j}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\gamma_{0}^{\alpha} + \gamma_{1}^{\alpha}(\operatorname{treatment}_{\operatorname{1}}) \\
      &amp;\gamma^{\beta_{1}}_{0} + \gamma^{\beta_{1}}_{1}(\operatorname{treatment}_{\operatorname{1}})
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cc}
     \sigma^2_{\alpha_{j}} &amp; \rho\alpha_{j}\beta_{1j} \\ 
     \rho\beta_{1j}\alpha_{j} &amp; \sigma^2_{\beta_{1j}}
  \end{array}
\right)
 \right)
    \text{, for sid j = 1,} \dots \text{,J} \\    \alpha_{k}  &amp;\sim N \left(\mu_{\alpha_{k}}, \sigma^2_{\alpha_{k}} \right)
    \text{, for school k = 1,} \dots \text{,K} \\    \alpha_{l}  &amp;\sim N \left(\mu_{\alpha_{l}}, \sigma^2_{\alpha_{l}} \right)
    \text{, for district l = 1,} \dots \text{,L}
\end{aligned}
\]</span></p>
<p>Note that the <code>treatement</code> variable is shown as a predictor of the level 1 intercept and the level 1 slope. But if the slope is not randomly varying at this level, then the notation has to change.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">cl_long2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">score</span> ~ <span class="no">wave</span>*<span class="no">treatment</span> + (<span class="fl">1</span><span class="kw">|</span><span class="no">sid</span>) + (<span class="fl">1</span><span class="kw">|</span><span class="no">school</span>) +
                        (<span class="fl">1</span><span class="kw">|</span><span class="no">district</span>),
                 <span class="kw">data</span> <span class="kw">=</span> <span class="no">sim_longitudinal</span>)
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">cl_long2</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{score}_{i}  &amp;\sim N \left(\alpha_{j[i],k[i],l[i]} + \beta_{1}(\operatorname{wave}), \sigma^2 \right) \\
    \alpha_{j}  &amp;\sim N \left(\gamma_{0}^{\alpha} + \gamma_{1}^{\alpha}(\operatorname{treatment}_{\operatorname{1}}) + \gamma_{2}^{\alpha}(\operatorname{treatment}_{\operatorname{1}} \times \operatorname{wave}), \sigma^2_{\alpha_{j}} \right)
    \text{, for sid j = 1,} \dots \text{,J} \\
    \alpha_{k}  &amp;\sim N \left(\mu_{\alpha_{k}}, \sigma^2_{\alpha_{k}} \right)
    \text{, for school k = 1,} \dots \text{,K} \\
    \alpha_{l}  &amp;\sim N \left(\mu_{\alpha_{l}}, \sigma^2_{\alpha_{l}} \right)
    \text{, for district l = 1,} \dots \text{,L}
\end{aligned}
\]</span></p>
<p>This works even for really complicated models, including three-way interactions that contain a cross-level interaction. For example</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">cl_long3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">score</span> ~ <span class="no">wave</span>*<span class="no">group</span>*<span class="no">treatment</span> + <span class="no">wave</span>*<span class="no">prop_low</span>*<span class="no">treatment</span> +
                  (<span class="no">wave</span><span class="kw">|</span><span class="no">sid</span>) + (<span class="no">wave</span><span class="kw">|</span><span class="no">school</span>) +
                  (<span class="no">wave</span> + <span class="no">treatment</span><span class="kw">|</span><span class="no">district</span>),
                <span class="no">sim_longitudinal</span>)
<span class="co">#&gt; boundary (singular) fit: see ?isSingular</span>
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">cl_long3</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{score}_{i}  &amp;\sim N \left(\alpha_{j[i],k[i],l[i]} + \beta_{1j[i],k[i],l[i]}(\operatorname{wave}), \sigma^2 \right) \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{j} \\
      &amp;\beta_{1j}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\gamma_{0}^{\alpha} + \gamma_{1}^{\alpha}(\operatorname{group}_{\operatorname{low}}) + \gamma_{2}^{\alpha}(\operatorname{group}_{\operatorname{medium}}) + \gamma_{3l[i]}^{\alpha}(\operatorname{treatment}_{\operatorname{1}}) + \gamma_{4}^{\alpha}(\operatorname{group}_{\operatorname{low}} \times \operatorname{treatment}_{\operatorname{1}}) + \gamma_{5}^{\alpha}(\operatorname{group}_{\operatorname{medium}} \times \operatorname{treatment}_{\operatorname{1}}) \\
      &amp;\gamma^{\beta_{1}}_{0} + \gamma^{\beta_{1}}_{1}(\operatorname{group}_{\operatorname{low}}) + \gamma^{\beta_{1}}_{2}(\operatorname{group}_{\operatorname{medium}}) + \gamma^{\beta_{1}}_{3}(\operatorname{treatment}_{\operatorname{1}}) + \gamma^{\beta_{1}}_{4}(\operatorname{group}_{\operatorname{low}} \times \operatorname{treatment}_{\operatorname{1}}) + \gamma^{\beta_{1}}_{5}(\operatorname{group}_{\operatorname{medium}} \times \operatorname{treatment}_{\operatorname{1}})
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cc}
     \sigma^2_{\alpha_{j}} &amp; \rho\alpha_{j}\beta_{1j} \\ 
     \rho\beta_{1j}\alpha_{j} &amp; \sigma^2_{\beta_{1j}}
  \end{array}
\right)
 \right)
    \text{, for sid j = 1,} \dots \text{,J} \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{k} \\
      &amp;\beta_{1k}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\gamma_{0}^{\alpha} + \gamma_{1}^{\alpha}(\operatorname{prop\_low}) + \gamma_{2}^{\alpha}(\operatorname{prop\_low} \times \operatorname{treatment}_{\operatorname{1}}) \\
      &amp;\gamma^{\beta_{1}}_{0} + \gamma^{\beta_{1}}_{1}(\operatorname{prop\_low}) + \gamma^{\beta_{1}}_{1}(\operatorname{prop\_low} \times \operatorname{treatment}_{\operatorname{1}})
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cc}
     \sigma^2_{\alpha_{k}} &amp; \rho\alpha_{k}\beta_{1k} \\ 
     \rho\beta_{1k}\alpha_{k} &amp; \sigma^2_{\beta_{1k}}
  \end{array}
\right)
 \right)
    \text{, for school k = 1,} \dots \text{,K} \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{l} \\
      &amp;\beta_{1l} \\
      &amp;\gamma_{3l}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\mu_{\alpha_{l}} \\
      &amp;\mu_{\beta_{1l}} \\
      &amp;\mu_{\gamma_{3l}}
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{ccc}
     \sigma^2_{\alpha_{l}} &amp; \rho\alpha_{l}\beta_{1l} &amp; \rho\alpha_{l}\gamma_{3l} \\ 
     \rho\beta_{1l}\alpha_{l} &amp; \sigma^2_{\beta_{1l}} &amp; \rho\beta_{1l}\gamma_{3l} \\ 
     \rho\gamma_{3l}\alpha_{l} &amp; \rho\gamma_{3l}\beta_{1l} &amp; \sigma^2_{\gamma_{3l}}
  \end{array}
\right)
 \right)
    \text{, for district l = 1,} \dots \text{,L}
\end{aligned}
\]</span></p>
</div>
<div id="alternative-variance-covariance-specifications" class="section level2">
<h2 class="hasAnchor">
<a href="#alternative-variance-covariance-specifications" class="anchor"></a>Alternative variance-covariance specifications</h2>
<p>Finally, there is some support for alternative variance-covariance specifications. For example, you may want to specify a model with only the variance terms estimated, and not the covariances.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">hsb_varsonly</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">math</span> ~ <span class="no">minority</span>*<span class="no">female</span> + (<span class="no">minority</span>*<span class="no">female</span> <span class="kw">||</span> <span class="no">sch.id</span>),
                       <span class="kw">data</span> <span class="kw">=</span> <span class="no">hsb</span>)
<span class="co">#&gt; boundary (singular) fit: see ?isSingular</span>
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">hsb_varsonly</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{math}_{i}  &amp;\sim N \left(\mu, \sigma^2 \right) \\
    \mu &amp;=\alpha_{j[i]} + \beta_{1j[i]}(\operatorname{minority}) + \beta_{2j[i]}(\operatorname{female}) + \beta_{3j[i]}(\operatorname{female} \times \operatorname{minority}) \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{j} \\
      &amp;\beta_{1j} \\
      &amp;\beta_{2j} \\
      &amp;\beta_{3j}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\mu_{\alpha_{j}} \\
      &amp;\mu_{\beta_{1j}} \\
      &amp;\mu_{\beta_{2j}} \\
      &amp;\mu_{\beta_{3j}}
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cccc}
     \sigma^2_{\alpha_{j}} &amp; 0 &amp; 0 &amp; 0 \\ 
     0 &amp; \sigma^2_{\beta_{1j}} &amp; 0 &amp; 0 \\ 
     0 &amp; 0 &amp; \sigma^2_{\beta_{2j}} &amp; 0 \\ 
     0 &amp; 0 &amp; 0 &amp; \sigma^2_{\beta_{3j}}
  \end{array}
\right)
 \right)
    \text{, for sch.id j = 1,} \dots \text{,J}
\end{aligned}
\]</span></p>
<p>Or maybe you want to group by the same thing multiple times. In this exact model I don’t think this makes any sense, but there are cases where it can. Note that, again, this model produces a warning.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">hsb_doublegroup</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">math</span> ~ <span class="no">minority</span>*<span class="no">female</span> +
                              (<span class="no">minority</span><span class="kw">|</span><span class="no">sch.id</span>) + (<span class="no">female</span><span class="kw">|</span><span class="no">sch.id</span>),
                         <span class="kw">data</span> <span class="kw">=</span> <span class="no">hsb</span>)
<span class="co">#&gt; Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :</span>
<span class="co">#&gt; Model failed to converge with max|grad| = 0.00319862 (tol = 0.002, component 1)</span>
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">hsb_doublegroup</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{math}_{i}  &amp;\sim N \left(\mu, \sigma^2 \right) \\
    \mu &amp;=\alpha_{j[i],k[i]} + \beta_{1j[i]}(\operatorname{minority}) + \beta_{2k[i]}(\operatorname{female}) + \beta_{3}(\operatorname{female} \times \operatorname{minority}) \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{j} \\
      &amp;\beta_{1j}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\mu_{\alpha_{j}} \\
      &amp;\mu_{\beta_{1j}}
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cc}
     \sigma^2_{\alpha_{j}} &amp; \rho\alpha_{j}\beta_{1j} \\ 
     \rho\beta_{1j}\alpha_{j} &amp; \sigma^2_{\beta_{1j}}
  \end{array}
\right)
 \right)
    \text{, for sch.id j = 1,} \dots \text{,J} \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{k} \\
      &amp;\beta_{2k}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\mu_{\alpha_{k}} \\
      &amp;\mu_{\beta_{2k}}
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cc}
     \sigma^2_{\alpha_{k}} &amp; \rho\alpha_{k}\beta_{2k} \\ 
     \rho\beta_{2k}\alpha_{k} &amp; \sigma^2_{\beta_{2k}}
  \end{array}
\right)
 \right)
    \text{, for sch.id.1 k = 1,} \dots \text{,K}
\end{aligned}
\]</span></p>
<p>And finally, you can have a mix of different things and it should generally still work.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">long_mixed_ranef</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">score</span> ~ <span class="no">wave</span> +
         (<span class="no">wave</span><span class="kw">||</span><span class="no">sid</span>) + (<span class="no">wave</span><span class="kw">|</span><span class="no">school</span>) + (<span class="fl">1</span><span class="kw">|</span><span class="no">school</span>) + (<span class="no">wave</span><span class="kw">||</span><span class="no">district</span>),
         <span class="no">sim_longitudinal</span>)
<span class="co">#&gt; boundary (singular) fit: see ?isSingular</span>
<span class="fu"><a href="../reference/extract_eq.html">extract_eq</a></span>(<span class="no">long_mixed_ranef</span>)</pre></body></html></div>
<p><span class="math display">\[
\begin{aligned}
  \operatorname{score}_{i}  &amp;\sim N \left(\alpha_{j[i],k[i],l[i],m[i]} + \beta_{1j[i],k[i],m[i]}(\operatorname{wave}), \sigma^2 \right) \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{j} \\
      &amp;\beta_{1j}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\mu_{\alpha_{j}} \\
      &amp;\mu_{\beta_{1j}}
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cc}
     \sigma^2_{\alpha_{j}} &amp; 0 \\ 
     0 &amp; \sigma^2_{\beta_{1j}}
  \end{array}
\right)
 \right)
    \text{, for sid j = 1,} \dots \text{,J} \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{k} \\
      &amp;\beta_{1k}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\mu_{\alpha_{k}} \\
      &amp;\mu_{\beta_{1k}}
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cc}
     \sigma^2_{\alpha_{k}} &amp; \rho\alpha_{k}\beta_{1k} \\ 
     \rho\beta_{1k}\alpha_{k} &amp; \sigma^2_{\beta_{1k}}
  \end{array}
\right)
 \right)
    \text{, for school k = 1,} \dots \text{,K} \\    \alpha_{l}  &amp;\sim N \left(\mu_{\alpha_{l}}, \sigma^2_{\alpha_{l}} \right)
    \text{, for school.1 l = 1,} \dots \text{,L} \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\alpha_{m} \\
      &amp;\beta_{1m}
    \end{aligned}
  \end{array}
\right)
  &amp;\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &amp;\mu_{\alpha_{m}} \\
      &amp;\mu_{\beta_{1m}}
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cc}
     \sigma^2_{\alpha_{m}} &amp; 0 \\ 
     0 &amp; \sigma^2_{\beta_{1m}}
  \end{array}
\right)
 \right)
    \text{, for district m = 1,} \dots \text{,M}
\end{aligned}
\]</span></p>
<p>With that said, this is the part of the code that I would consider the most “experimental” at this point, so please do reach out if you have issues or run into use cases that are not supported.</p>
</div>
<div id="future-developments" class="section level2">
<h2 class="hasAnchor">
<a href="#future-developments" class="anchor"></a>Future developments</h2>
<p>There are still a few things I’m planning to implement that I haven’t quite gotten around to yet. These include</p>
<ul>
<li>Implementation of <code>use_coef</code>. This is relatively straightforward and should be implemented soon.</li>
<li>Implementation of other features currently included in the <code>lm</code> extraction, including <code>intercept</code>, and <code>raw_tex</code>
</li>
<li>Inevitable bug fixes</li>
</ul>
<p>The range of models that you can fit with <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lme4::lmer</a></code> is huge, but I hope this will handle a wide range of models. I also recognize that some users may want a different notation for the models. At this point, I’m not planning to implement other notations, but that could change if there’s enough demand for it. I’m open to any/all suggestions for how to improve the package, and would <em>love</em> pull requests to help support the package, big or small.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Anderson, Andrew Heiss.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
